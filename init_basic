#!/usr/bin/env bash

set -u
set -e

DISTRO_ID=

if [ -z "$CUSTOM_BIN" ]; then
    echo "CUSTOM_BIN is not set or is empty. Exiting."
    exit 1
fi

if [ ! -d $CUSTOM_BIN ]; then
    mkdir -p $CUSTOM_BIN
fi

echo "initializing basic components..."

amd64_install() {
    #lf
    wget -O - https://github.com/gokcehan/lf/releases/latest/download/lf-linux-amd64.tar.gz | tar -xz -C $CUSTOM_BIN

    # fzf
    curl https://api.github.com/repos/junegunn/fzf/releases/latest | jq -r '.assets[3] | .browser_download_url' | xargs wget -O - | tar -xz -C $CUSTOM_BIN

    # this one is the official install script for fzf
    # git clone --depth 1 https://github.com/junegunn/fzf.git ~/.fzf
    # ~/.fzf/install
}

if [ -d "/data/data/com.termux" ]; then
    DISTRO_ID=termux
else
    DISTRO_ID=$(grep '^ID' /etc/os-release | cut -d '=' -f2)
fi

case "$DISTRO_ID" in
termux)
    pkg install vim stow unzip grep fzf lf
    ;;
arch)
    # basic requirement is that you've already installed git (and flatpak) beforehand
    alias get="sudo pacman -S --noconfirm --needed"

    get ufw
    sudo systemctl enable --now ufw

    get stow btop ntfs-3g wl-clipboard rsync less man-db udftools exfatprogs dosfstools f2fs-tools vim zoxide unzip zsh tmux fzf lf system-config-printer
    
    unalias get 
    ;;
fedora)
    sudo dnf install stow vim zoxide -y
    amd64_install
    ;;
ubuntu)
    sudo apt install stow vim zoxide
    amd64_install
    ;;
esac

if [ -f ~/.bashrc ]; then
	rm -f ~/.bashrc
fi

stow -d ~/dotfiles -t ~ .

# source ~/.bashrc

echo "all basic components are successfully installed"
